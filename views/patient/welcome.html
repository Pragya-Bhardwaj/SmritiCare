<!DOCTYPE html>
<html>
<head>
  <title>Invite Caregiver</title>
  <link rel="stylesheet" href="/css/auth.css">
</head>
<body>

<div class="auth-wrapper">
  <div class="auth-card">
    <h2 class="auth-title">Welcome!</h2>
    <p class="auth-subtitle">Share this invite code with your caregiver</p>

    <div class="invite-code" id="inviteCode">----</div>

    <p class="waiting-text" id="statusText">
      Waiting for caregiver to link
    </p>

    <button
      id="dashboardBtn"
      class="auth-btn disabled-btn"
      disabled
      onclick="goPatientDashboard()"
    >
      Go to Dashboard
    </button>
  </div>
</div>

<script>
function goPatientDashboard() {
  window.location.href = "/patient/dashboard";
}

async function loadInviteCode() {
  try {
    const res = await fetch("/patient/invite-code");
    const data = await res.json();
    document.getElementById("inviteCode").innerText = data.code || "----";
  } catch (err) {
    console.error("Failed to load invite code");
  }
}

let poller = null;

async function checkLinkStatus() {
  try {
    const res = await fetch("/patient/link-status");
    const data = await res.json();

    if (data.linked) {
      const btn = document.getElementById("dashboardBtn");
      btn.disabled = false;
      btn.classList.remove("disabled-btn");

      document.getElementById("statusText").innerText =
        "Caregiver linked successfully!";

      clearInterval(poller); // ðŸ›‘ stop polling once linked
    }
  } catch (err) {
    console.error("Link status check failed");
  }
}

// INIT
loadInviteCode();
poller = setInterval(checkLinkStatus, 3000);
</script>
<script src="/js/patientApp.js"></script>

</body>
</html>
